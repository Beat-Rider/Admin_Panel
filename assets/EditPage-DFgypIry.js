import{i as E,Q as F,a as $,b as Y,d as M,e as u,f as C,h as D}from"./QPage-CF6o7v5V.js";import{c as j,r as x,a0 as A,a1 as O,o as K,g as T,h as W,b as z,a2 as G,B as I,f as H,E as J,a3 as X,M as Q,N as B,O as f,$ as q,R as o,a4 as Z,Q as h,S as P,W as _,a5 as R}from"./index-CFGij7_S.js";import"./format-CpzSwQcR.js";const ee=j({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(p,{slots:S,emit:l}){const U=T(),v=x(null);let s=0;const i=[];function b(e){const t=typeof e=="boolean"?e:p.noErrorFocus!==!0,r=++s,k=(n,d)=>{l(`validation${n===!0?"Success":"Error"}`,d)},L=n=>{const d=n.validate();return typeof d.then=="function"?d.then(m=>({valid:m,comp:n}),m=>({valid:!1,comp:n,err:m})):Promise.resolve({valid:d,comp:n})};return(p.greedy===!0?Promise.all(i.map(L)).then(n=>n.filter(d=>d.valid!==!0)):i.reduce((n,d)=>n.then(()=>L(d).then(m=>{if(m.valid===!1)return Promise.reject(m)})),Promise.resolve()).catch(n=>[n])).then(n=>{if(n===void 0||n.length===0)return r===s&&k(!0),!0;if(r===s){const{comp:d,err:m}=n[0];if(m!==void 0&&console.error(m),k(!1,d),t===!0){const N=n.find(({comp:w})=>typeof w.focus=="function"&&G(w.$)===!1);N!==void 0&&N.comp.focus()}}return!1})}function V(){s++,i.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function g(e){e!==void 0&&I(e);const t=s+1;b().then(r=>{t===s&&r===!0&&(p.onSubmit!==void 0?l("submit",e):e?.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function c(e){e!==void 0&&I(e),l("reset"),H(()=>{V(),p.autofocus===!0&&p.noResetFocus!==!0&&y()})}function y(){E(()=>{if(v.value===null)return;(v.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||v.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||v.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(v.value.querySelectorAll("[tabindex]"),t=>t.tabIndex!==-1))?.focus({preventScroll:!0})})}J(X,{bindComponent(e){i.push(e)},unbindComponent(e){const t=i.indexOf(e);t!==-1&&i.splice(t,1)}});let a=!1;return A(()=>{a=!0}),O(()=>{a===!0&&p.autofocus===!0&&y()}),K(()=>{p.autofocus===!0&&y()}),Object.assign(U.proxy,{validate:b,resetValidation:V,submit:g,reset:c,focus:y,getValidationComponents:()=>i}),()=>W("form",{class:"q-form",ref:v,onSubmit:g,onReset:c},z(S.default))}}),te={class:"q-pa-md",style:{"max-width":"400px",margin:"auto"}},ue={__name:"EditPage",setup(p){console.log("updateData RUN");const S=x({photo:null,name:"",surname:"",midName:"",callSign:"",b_date:"",place:"",d_date:"",rank:"",lifeStory:"",Latitude:"",Longitude:"",address:""}),l=x({photo:null,name:"",surname:"",midName:"",callSign:"",b_date:"",place:"",d_date:"",rank:"",lifeStory:"",Latitude:"",Longitude:"",address:""});function U(a){return{name:"Ім'я",surname:"Прізвище",midName:"По-батькові",callSign:"Позивний",place:"Місце Народження",lifeStory:"Життєва Історія",b_date:"Дата Народження",d_date:"Дата Смерті",rank:"Звання",Latitude:"Широта",Longitude:"Довгота",address:"Адреса",photo:"Фото"}[a]||a}function v(){const a=[];for(const e in l.value){const t=l.value[e],r=S.value[e];t===""||t===null||typeof t=="string"&&t.trim()===""||t!==r&&(a.push({field:e,before:r,after:typeof t=="string"?t.trim():t}),S.value[e]=typeof t=="string"?t.trim():t)}if(a.length>0){const e=a.map(t=>`• ${U(t.field)}: "${t.before||"-"}" → "${t.after}"`).join("<br>");R.create({message:`✅ Зміни збережено:<br>${e}`,color:"green-7",html:!0,position:"top",icon:"check_circle",timeout:1e4})}else R.create({message:"ℹ️ Ви не змінили жодного поля",color:"amber-8",icon:"warning",position:"top"});for(const e in l.value)l.value[e]=e==="photo"?null:""}const s=x(null),i=a=>{a?s.value=URL.createObjectURL(a):s.value=null},b=[a=>a===""||a.trim().length>=2||"Мінімум 2 літери",a=>a===""||/^[А-ЯІЇЄҐ][А-Яа-яІЇЄҐіїєґʼ' -]+$/.test(a)||"Перша Велика. Українська. Дефіс та апостроф дозволені."],V=a=>{let e=l.value[a];e&&(e=e.replace(/[^А-Яа-яІЇЄҐіїєґʼ' -]/g,""),e=e.replace(/\s+/g," ").trim(),e=e.replace(/-{2,}/g,"-"),e=e.replace(/[’']{2,}/g,"'"),e=e.split(" ").map(t=>t.split("-").map(r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()).join("-")).join(" "),l.value[a]=e)},g=x(!1),c=x(!1),y=[a=>a===""||a.length<=250||"Максимум 250 символів",a=>a===""||a.length>=40||"Мінімум 40 символів"];return(a,e)=>(B(),Q(F,{padding:""},{default:f(()=>[q("div",te,[o($,{flat:"",bordered:"",class:"q-pa-lg shadow-2"},{default:f(()=>[o(ee,{onSubmit:Z(v,["prevent"])},{default:f(()=>[q("div",null,[e[26]||(e[26]=q("div",{class:"text-center q-mb-xs",style:{"margin-bottom":"2vh"}}," Введіть Дані Що Бажаєте Редагувати ",-1)),o(Y,{modelValue:l.value.photo,"onUpdate:modelValue":[e[0]||(e[0]=t=>l.value.photo=t),i],accept:"image/*",label:"Оберіть Одне Фото",outlined:"","use-chips":"",style:{"margin-bottom":"2vh"}},null,8,["modelValue"]),s.value?(B(),Q(M,{key:0,src:s.value,class:"q-mt-md",style:{"max-width":"300px","border-radius":"8px","margin-bottom":"2vh"}},null,8,["src"])):h("",!0)]),o(u,{modelValue:l.value.name,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.name=t),label:"Ім'я",type:"text",outlined:"",rules:b,onInput:e[2]||(e[2]=t=>V("name")),class:"q-mb-md"},null,8,["modelValue"]),o(u,{modelValue:l.value.surname,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.surname=t),label:"Прізвище",type:"text",outlined:"",rules:b,onInput:e[4]||(e[4]=t=>V("surname")),class:"q-mb-md"},null,8,["modelValue"]),o(u,{modelValue:l.value.midName,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.midName=t),label:"По-Батькові",type:"text",outlined:"",rules:b,onInput:e[6]||(e[6]=t=>V("midName")),class:"q-mb-md"},null,8,["modelValue"]),o(u,{modelValue:l.value.callSign,"onUpdate:modelValue":e[7]||(e[7]=t=>l.value.callSign=t),label:"Позивний",type:"text",outlined:"",rules:b,onInput:e[8]||(e[8]=t=>V("callSign")),class:"q-mb-md"},null,8,["modelValue"]),o(u,{modelValue:l.value.b_date,"onUpdate:modelValue":e[9]||(e[9]=t=>l.value.b_date=t),label:"Дата народження",outlined:"",readonly:"",onClick:e[10]||(e[10]=t=>g.value=!0),class:"q-mb-md"},{append:f(()=>[o(P,{name:"event"})]),_:1},8,["modelValue"]),o(C,{modelValue:g.value,"onUpdate:modelValue":e[13]||(e[13]=t=>g.value=t)},{default:f(()=>[o($,null,{default:f(()=>[o(D,{modelValue:l.value.b_date,"onUpdate:modelValue":[e[11]||(e[11]=t=>l.value.b_date=t),e[12]||(e[12]=t=>g.value=!1)],mask:"DD.MM.YYYY"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),o(u,{modelValue:l.value.place,"onUpdate:modelValue":e[14]||(e[14]=t=>l.value.place=t),label:"Місце Народження",type:"text",outlined:"",rules:b,onInput:e[15]||(e[15]=t=>V("place")),class:"q-mb-md"},null,8,["modelValue"]),o(u,{modelValue:l.value.d_date,"onUpdate:modelValue":e[16]||(e[16]=t=>l.value.d_date=t),label:"Дата Смерті",outlined:"",readonly:"",onClick:e[17]||(e[17]=t=>c.value=!0),class:"q-mb-md"},{append:f(()=>[o(P,{name:"event"})]),_:1},8,["modelValue"]),o(C,{modelValue:c.value,"onUpdate:modelValue":e[20]||(e[20]=t=>c.value=t)},{default:f(()=>[o($,null,{default:f(()=>[o(D,{modelValue:l.value.d_date,"onUpdate:modelValue":[e[18]||(e[18]=t=>l.value.d_date=t),e[19]||(e[19]=t=>c.value=!1)],mask:"DD.MM.YYYY"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),o(u,{modelValue:l.value.rank,"onUpdate:modelValue":e[21]||(e[21]=t=>l.value.rank=t),label:"Звання",type:"text",outlined:"",class:"q-mb-md"},null,8,["modelValue"]),o(u,{modelValue:l.value.lifeStory,"onUpdate:modelValue":e[22]||(e[22]=t=>l.value.lifeStory=t),label:"Життєва Історія",type:"textarea",outlined:"",autogrow:"",maxlength:"250",counter:"",rules:y,class:"q-mb-md"},null,8,["modelValue"]),e[27]||(e[27]=q("div",{class:"text-h6 text-center q-mb-md"},"Координати Поховання",-1)),o(u,{modelValue:l.value.Latitude,"onUpdate:modelValue":e[23]||(e[23]=t=>l.value.Latitude=t),label:"Широта(Latitude)",type:"number",outlined:"",step:"any",class:"q-mb-md"},null,8,["modelValue"]),o(u,{modelValue:l.value.Longitude,"onUpdate:modelValue":e[24]||(e[24]=t=>l.value.Longitude=t),label:"Довгота(Longitude)",type:"number",outlined:"",step:"any",class:"q-mb-md"},null,8,["modelValue"]),o(u,{modelValue:l.value.address,"onUpdate:modelValue":e[25]||(e[25]=t=>l.value.address=t),label:"Адреса Могили",type:"textarea",outlined:"",class:"q-mb-md"},null,8,["modelValue"]),o(_,{type:"submit",label:"Зберегти",color:"primary",class:"full-width"})]),_:1})]),_:1})])]),_:1}))}};export{ue as default};
